import{t as e,L as t,S as s}from"./index.d1d457be.js";import{h as r}from"./vendor.92c00e27.js";var a={"green-dark":{fill:"#2e7d32",stroke:"#286c2b"},green:{fill:"#689f38",stroke:"#5b8c31"},lime:{fill:"#afb42b",stroke:"#9ca126"},amber:{fill:"#ffa000",stroke:"#e69000"},orange:{fill:"#f57c00",stroke:"#d66c00"},red:{fill:"#e53935",stroke:"#e2221d"}};const i=r.exports.compile(e);const n=r.exports.compile('<div class="card" data-note-id="{{id}}">\n  <div class="card-header">\n    {{{badges.user}}}\n    {{{badges.age}}}\n    {{{badges.comments}}}\n    {{{badges.country}}}\n    {{{badges.report}}}\n  </div>\n\n  <div class="card-body text-break">\n    {{{comments.0.html}}}\n  </div>\n\n  <div class="card-footer">\n    {{> actions actions}}\n  </div>\n</div>\n');const o={map:new class{constructor(){this.map=new t("map-container"),this.container=document.getElementById("note-container"),this.active=null,this.cluster=L.markerClusterGroup({maxClusterRadius:40,showCoverageOnHover:!1}),this.map.addLayer(this.cluster),this.markers=[],this.halo=L.circleMarker([0,0]),this.map.addLayer(this.halo),this.features=L.geoJSON(),this.map.addLayer(this.features),this.map.onClick((()=>this.clear()))}add(e,t){let r;r=t.data.status===s.ALL?e.status===s.OPEN?"markers/green.svg":"markers/red.svg":`markers/${e.color}.svg`;const n=L.marker(e.coordinates,{icon:new L.divIcon({html:`<img alt="" src="${r}">`,iconSize:[25,40],iconAnchor:[12.5,40],popupAnchor:[0,-30],className:"marker-icon"})});n.on("click",(()=>{if(this.active===e)return;this.clear(),this.active=e,this.container.innerHTML=i(e,{allowedProtoProperties:{actions:!0,badges:!0}}),setTimeout((()=>{this.container.classList.remove("out-of-view")}),100),this.halo=L.circleMarker(e.coordinates,{color:a[e.color].fill,weight:1}),this.map.addLayer(this.halo);const{linked:t}=e;if(t){const e=`\n          [out:json];\n          ${t.type}(id:${t.id});\n          convert Feature ::=::,::id=id(),::geom=geom();\n          out geom tags;`;fetch("https://overpass-api.de/api/interpreter",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({data:e})}).then((e=>{if(e.ok)return e.json();throw new Error(`Error while fetching Overpass API: ${e.status} ${e.statusText}`)})).then((e=>{if(!("elements"in e)||0===e.elements.length)return;const[t]=e.elements;"Point"!==t.geometry.type&&this.features.addData(t)}))}})),this.markers.push(n)}clear(){this.active=null,this.halo.remove(),this.features.clearLayers(),this.container.classList.add("out-of-view")}apply(e){this.map.resize(),this.clear(),this.cluster.clearLayers(),this.cluster.addLayers(this.markers),!e&&this.markers.length>0&&this.map.flyToBounds(this.cluster.getBounds(),1),this.markers=[]}},list:new class{constructor(){this.fragment=new DocumentFragment,this.children=[]}add(e){const t=document.createElement("div");t.classList.add("column","col-4","col-md-6","col-sm-12","p-1"),t.innerHTML=n(e,{allowedProtoProperties:{actions:!0,badges:!0}}),this.fragment.appendChild(t)}apply(){const e=document.getElementById("list");for(;e.lastChild;)e.removeChild(e.lastChild);document.getElementById("list").appendChild(this.fragment)}}};export default class{constructor(e){this.notes=[],this.query=null,this.view=e}set view(e){const t=Object.keys(o);if(!t.includes(e))throw new TypeError(`Argument must be one of ${t.join(", ")}`);this._view={name:e,handler:o[e]},this.reload()}get view(){return this._view.name}show(e,t,s){this.query=t,this.notes=e;const r=e.length,a=e.reduce(((e,t)=>e+t.created.getTime()),0)/r;return e.forEach((e=>{this.isNoteVisible(e,t)&&this._view.handler.add(e,t)})),this._view.handler.apply(s),Promise.resolve({amount:r,average:new Date(a)})}isNoteVisible(e,t){return!(t.data.status===s.OPEN&&e.status!==s.OPEN||t.data.status===s.CLOSED&&e.status!==s.CLOSED)}get(e){return this.notes.find((t=>t.id===e))}update(e,t){const s=this.notes.findIndex((t=>t.id===e));if(-1===s)throw new Error(`The note with the id ${e} could not be found in the array`);return this.notes[s]=t,this.reload()}reload(){return this.show(this.notes,this.query,!0)}}
//# sourceMappingURL=ui.ca20d2c9.js.map
